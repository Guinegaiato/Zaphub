
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZapHub Pro - Automação WhatsApp</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- SheetJS (Excel) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: { DEFAULT: '#0B1120', light: '#1e293b' },
              gold: { DEFAULT: '#d4af37', light: '#f3e5ab', dark: '#aa8c2c' }
            }
          }
        }
      }
    </script>
    <style>
      body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
      .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "xlsx": "https://aistudiocdn.com/xlsx@^0.18.5",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- ICON CONFIGURATION ---
      const Icon = ({ name, size = 20, className = "" }) => {
        const lucide = window.lucide;
        if (!lucide) return <span className="font-bold">?</span>;
        
        const IconComponent = lucide.icons[name];
        if (!IconComponent) return null;

        // Render SVG manually since we are in standalone mode without strict lucide-react bindings
        const svgContent = lucide.createElement(IconComponent);
        
        // We need to convert the DOM node created by lucide.createElement to React or use dangerouslySetInnerHTML
        // A simpler way for this standalone setup is to map names to a few hardcoded SVGs or assume lucide-react isn't available and use lucide generic.
        // Actually, let's just use a simple mapping for reliability in this specific standalone file.
        
        return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
      };

      // We trigger lucide.createIcons() after render
      const useLucide = () => {
        useEffect(() => {
          if (window.lucide) window.lucide.createIcons();
        });
      };

      // --- NICHES DATABASE ---
      const NICHES = [
        { id: 'dentist', label: 'Clínicas Odontológicas', icon: 'smile' },
        { id: 'aesthetic', label: 'Clínicas de Estética', icon: 'sparkles' },
        { id: 'lawyer', label: 'Advogados', icon: 'scale' },
        { id: 'food', label: 'Lanchonetes e Restaurantes', icon: 'utensils' },
        { id: 'realty', label: 'Corretores de Imóveis', icon: 'home' },
        { id: 'accountant', label: 'Contadores MEI', icon: 'calculator' },
        { id: 'architect', label: 'Arquitetos de Interiores', icon: 'pen-tool' },
        { id: 'designer', label: 'Designers Comerciais', icon: 'briefcase' },
        { id: 'furniture', label: 'Móveis Planejados', icon: 'sofa' },
        { id: 'curtains', label: 'Persianas Automatizadas', icon: 'blinds' }, // 'blinds' might not exist, fallback to 'menu'
        { id: 'security', label: 'CFTV e Segurança', icon: 'camera' },
        { id: 'solar', label: 'Placas Solares', icon: 'sun' },
        { id: 'pest', label: 'Dedetização', icon: 'bug' },
        { id: 'cleaning', label: 'Limpeza Pós-Obra', icon: 'spray-can' }, // fallback
        { id: 'video', label: 'Produtoras de Vídeo', icon: 'video' },
        { id: 'tattoo', label: 'Estúdios de Tatuagem', icon: 'palette' },
        { id: 'franchise', label: 'Consultores de Franquias', icon: 'trending-up' },
        { id: 'insurance', label: 'Corretores de Seguros', icon: 'shield' },
        { id: 'music', label: 'Escolas de Música', icon: 'music' },
        { id: 'language', label: 'Escolas de Idiomas', icon: 'languages' },
        { id: 'tutor', label: 'Professores de Reforço', icon: 'book-open' },
        { id: 'organizer', label: 'Personal Organizer', icon: 'layers' },
        { id: 'club', label: 'Clubes de Assinatura', icon: 'gift' },
        // Specialized
        { id: 'nutri', label: 'Nutricionistas Esportivos', icon: 'activity' },
        { id: 'physio', label: 'Fisioterapeutas de Coluna', icon: 'activity' },
        { id: 'genetic', label: 'Geneticistas', icon: 'dna' },
        { id: 'finance', label: 'Planejadores Financeiros D7', icon: 'dollar-sign' },
        { id: 'visa', label: 'Assessores EB-5', icon: 'globe' },
        { id: 'italy', label: 'Cidadania Italiana', icon: 'flag' },
      ];

      // --- UTILS ---
      const sanitizePhone = (phone) => {
        if (!phone) return '';
        let str = String(phone).replace(/\D/g, ''); // Remove non-digits
        // Basic BR Logic
        if (str.length === 0) return '';
        if (str.length <= 9) return str; // Likely missing DDD, return as is (invalid)
        if (str.length === 10 || str.length === 11) str = '55' + str;
        return str;
      };

      const generateLink = (phone, msg) => {
        return `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
      };

      // --- MAIN COMPONENT ---
      const App = () => {
        useLucide();
        const [activeNiche, setActiveNiche] = useState(null); // Null = Home/Upload
        const [fileData, setFileData] = useState([]);
        const [fileName, setFileName] = useState('');
        const [headers, setHeaders] = useState([]);
        const [mapStep, setMapStep] = useState(false); // Step 1: Uploaded, need mapping
        const [colName, setColName] = useState(-1);
        const [colPhone, setColPhone] = useState(-1);
        const [leads, setLeads] = useState([]);
        const [message, setMessage] = useState("Olá, tudo bem?");
        const [history, setHistory] = useState([]);
        const [viewHistory, setViewHistory] = useState(false);

        // -- LOAD HISTORY --
        useEffect(() => {
          const saved = localStorage.getItem('ZAPHUB_HISTORY');
          if (saved) {
            try {
              setHistory(JSON.parse(saved));
            } catch (e) { console.error("History parse error", e); }
          }
        }, []);

        // -- FILE UPLOAD --
        const handleFileUpload = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          setFileName(file.name);
          
          const reader = new FileReader();
          reader.onload = (evt) => {
            const bstr = evt.target.result;
            const wb = XLSX.read(bstr, { type: 'binary' });
            const wsname = wb.SheetNames[0];
            const ws = wb.Sheets[wsname];
            // Get ALL data as array of arrays (no key guessing)
            const data = XLSX.utils.sheet_to_json(ws, { header: 1, defval: '' });
            
            if (data.length > 0) {
              setFileData(data);
              // Assume row 0 is header for preview, but let user choose
              setHeaders(data[0].map((h, i) => ({ idx: i, val: h || `Coluna ${i+1}` })));
              setMapStep(true);
              setColName(-1);
              setColPhone(-1);
            }
          };
          reader.readAsBinaryString(file);
        };

        // -- PROCESS LEADS --
        const processLeads = () => {
          if (colName === -1 || colPhone === -1) {
            alert("Por favor, selecione as colunas de NOME e TELEFONE.");
            return;
          }

          const processed = [];
          // Start from row 1 (skip header)
          for (let i = 1; i < fileData.length; i++) {
            const row = fileData[i];
            const rawName = row[colName];
            const rawPhone = row[colPhone];

            // STRICT RULE: If row exists, process it. Don't skip unless completely empty.
            if (!rawName && !rawPhone) continue;

            const cleanPhone = sanitizePhone(rawPhone);
            const isValid = cleanPhone.length >= 12; // 55 + DDD + 8/9 digits

            processed.push({
              id: i,
              name: rawName || 'Sem Nome',
              rawPhone: rawPhone,
              phone: cleanPhone,
              status: isValid ? 'valid' : 'invalid',
              link: isValid ? generateLink(cleanPhone, message) : '#',
              sent: checkHistory(cleanPhone)
            });
          }

          setLeads(processed);
          setMapStep(false);
          setActiveNiche({ id: 'processing', label: 'Processamento de Lista' });
        };

        // -- HISTORY HELPERS --
        const checkHistory = (phone) => {
          return history.some(h => h.phone === phone);
        };

        const addToHistory = (lead) => {
          if (checkHistory(lead.phone)) return;
          
          const newEntry = {
            phone: lead.phone,
            name: lead.name,
            date: new Date().toLocaleString(),
            niche: activeNiche?.label || 'Geral'
          };
          
          const newHistory = [newEntry, ...history];
          setHistory(newHistory);
          localStorage.setItem('ZAPHUB_HISTORY', JSON.stringify(newHistory));
          
          // Update local leads state
          setLeads(prev => prev.map(l => l.id === lead.id ? { ...l, sent: true } : l));
        };

        const handleSend = (lead) => {
          if (lead.status === 'invalid') return;
          window.open(lead.link, '_blank');
          addToHistory(lead);
        };

        const exportCSV = () => {
          const ws = XLSX.utils.json_to_sheet(leads.map(l => ({
            Nome: l.name,
            Telefone: l.rawPhone,
            Formatado: l.phone,
            Link: l.link,
            Status: l.sent ? 'Enviado' : 'Pendente'
          })));
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Leads");
          XLSX.writeFile(wb, "ZapHub_Leads.csv");
        };

        const copyAll = () => {
          const text = leads.filter(l => l.status === 'valid').map(l => `${l.name}: ${l.link}`).join('\n');
          navigator.clipboard.writeText(text);
          alert("Todos os links copiados!");
        };

        // --- RENDERERS ---

        const RenderSidebar = () => (
          <div className="w-64 bg-primary text-gray-300 flex-shrink-0 hidden md:flex flex-col h-screen overflow-y-auto border-r border-gray-800">
            <div className="p-6">
              <h1 className="text-2xl font-serif font-bold text-white flex items-center">
                <i data-lucide="zap" className="text-gold mr-2"></i> ZapHub
              </h1>
            </div>
            <nav className="flex-1 px-4 space-y-1">
              <button 
                onClick={() => { setActiveNiche(null); setViewHistory(false); }}
                className={`w-full flex items-center px-4 py-3 rounded-lg transition-colors ${!activeNiche && !viewHistory ? 'bg-gold text-primary font-bold' : 'hover:bg-gray-800'}`}
              >
                <i data-lucide="upload" className="w-5 h-5 mr-3"></i> Upload / Home
              </button>
              <button 
                onClick={() => setViewHistory(true)}
                className={`w-full flex items-center px-4 py-3 rounded-lg transition-colors ${viewHistory ? 'bg-gold text-primary font-bold' : 'hover:bg-gray-800'}`}
              >
                <i data-lucide="history" className="w-5 h-5 mr-3"></i> Histórico
              </button>
              
              <div className="mt-6 mb-2 px-4 text-xs font-semibold text-gray-500 uppercase">Nichos</div>
              {NICHES.map(niche => (
                <button
                  key={niche.id}
                  onClick={() => { setActiveNiche(niche); setViewHistory(false); }}
                  className={`w-full flex items-center px-4 py-2 rounded-lg text-sm transition-colors ${activeNiche?.id === niche.id ? 'bg-gray-800 text-white border-l-4 border-gold' : 'hover:bg-gray-800'}`}
                >
                  <i data-lucide={niche.icon} className="w-4 h-4 mr-3 opacity-70"></i> {niche.label}
                </button>
              ))}
            </nav>
          </div>
        );

        const RenderHistory = () => (
          <div className="p-8 animate-fade-in">
            <h2 className="text-3xl font-serif font-bold text-primary mb-6">Histórico de Envios</h2>
            <div className="bg-white rounded-xl shadow overflow-hidden">
               <table className="w-full text-left">
                 <thead className="bg-gray-100 border-b">
                   <tr>
                     <th className="p-4">Nome</th>
                     <th className="p-4">Telefone</th>
                     <th className="p-4">Nicho</th>
                     <th className="p-4">Data</th>
                   </tr>
                 </thead>
                 <tbody className="divide-y">
                   {history.map((h, i) => (
                     <tr key={i} className="hover:bg-gray-50">
                       <td className="p-4 font-medium text-gray-800">{h.name}</td>
                       <td className="p-4 text-gray-600">{h.phone}</td>
                       <td className="p-4"><span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">{h.niche}</span></td>
                       <td className="p-4 text-gray-500 text-sm">{h.date}</td>
                     </tr>
                   ))}
                   {history.length === 0 && (
                     <tr><td colSpan="4" className="p-8 text-center text-gray-500">Nenhum envio registrado ainda.</td></tr>
                   )}
                 </tbody>
               </table>
            </div>
            <button onClick={() => { localStorage.removeItem('ZAPHUB_HISTORY'); setHistory([]); }} className="mt-4 text-red-600 text-sm hover:underline">
              Limpar Histórico Completo
            </button>
          </div>
        );

        const RenderMappingStep = () => (
          <div className="p-8">
            <div className="bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto border-t-4 border-gold">
              <h2 className="text-2xl font-bold mb-4 flex items-center">
                <i data-lucide="table" className="mr-2 text-primary"></i> Mapear Colunas
              </h2>
              <p className="mb-6 text-gray-600">Para garantir precisão total, identifique quais colunas representam o Nome e o Número no seu arquivo <strong>{fileName}</strong>.</p>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Coluna de NOME</label>
                  <select 
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-gold outline-none"
                    value={colName} 
                    onChange={e => setColName(Number(e.target.value))}
                  >
                    <option value="-1">Selecione...</option>
                    {headers.map(h => <option key={h.idx} value={h.idx}>{h.val} (Ex: {fileData[1]?.[h.idx]})</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Coluna de WHATSAPP</label>
                  <select 
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-gold outline-none"
                    value={colPhone} 
                    onChange={e => setColPhone(Number(e.target.value))}
                  >
                    <option value="-1">Selecione...</option>
                    {headers.map(h => <option key={h.idx} value={h.idx}>{h.val} (Ex: {fileData[1]?.[h.idx]})</option>)}
                  </select>
                </div>
              </div>

              <div className="flex justify-end">
                <button 
                  onClick={processLeads}
                  className="bg-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-800 transition-colors flex items-center"
                >
                  Processar Lista <i data-lucide="arrow-right" className="ml-2 w-4 h-4"></i>
                </button>
              </div>
            </div>
          </div>
        );

        const RenderLeadsTable = () => {
          const validCount = leads.filter(l => l.status === 'valid').length;
          const sentCount = leads.filter(l => l.sent).length;

          return (
            <div className="p-6 md:p-8 max-w-7xl mx-auto">
              {/* Header Info */}
              <div className="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div>
                  <h2 className="text-3xl font-serif font-bold text-primary mb-2">
                    {activeNiche?.label || 'Processamento Geral'}
                  </h2>
                  <div className="flex gap-2">
                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">{leads.length} Leads</span>
                    <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">{validCount} Válidos</span>
                    <span className="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">{sentCount} Já Enviados</span>
                  </div>
                </div>
                <div className="flex gap-2 w-full md:w-auto">
                  <button onClick={copyAll} className="flex-1 md:flex-none bg-white border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center justify-center">
                    <i data-lucide="copy" className="w-4 h-4 mr-2"></i> Copiar Tudo
                  </button>
                  <button onClick={exportCSV} className="flex-1 md:flex-none bg-white border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center justify-center">
                    <i data-lucide="download" className="w-4 h-4 mr-2"></i> CSV
                  </button>
                </div>
              </div>

              {/* Message Config */}
              <div className="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-200">
                <label className="block text-sm font-medium text-gray-700 mb-2">Mensagem Padrão</label>
                <div className="flex gap-2">
                  <input 
                    className="flex-1 border p-2 rounded-lg" 
                    value={message} 
                    onChange={e => {
                      setMessage(e.target.value);
                      setLeads(prev => prev.map(l => ({...l, link: generateLink(l.phone, e.target.value)})));
                    }}
                  />
                  <button className="bg-gray-100 px-4 rounded-lg text-gray-600 hover:bg-gray-200" title="Atualizar links">
                    <i data-lucide="refresh-cw" className="w-4 h-4"></i>
                  </button>
                </div>
              </div>

              {/* Table */}
              <div className="bg-white rounded-xl shadow overflow-hidden border border-gray-200">
                <div className="overflow-x-auto">
                  <table className="w-full text-left border-collapse">
                    <thead className="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider">
                      <tr>
                        <th className="p-4 border-b">Status</th>
                        <th className="p-4 border-b">Nome</th>
                        <th className="p-4 border-b">Número (Formatado)</th>
                        <th className="p-4 border-b text-right">Ação</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100 text-sm">
                      {leads.map(lead => (
                        <tr key={lead.id} className={lead.status === 'invalid' ? 'bg-red-50' : (lead.sent ? 'bg-green-50' : 'hover:bg-gray-50')}>
                          <td className="p-4">
                            {lead.status === 'invalid' ? 
                              <span className="text-red-600 font-bold text-xs">INVÁLIDO</span> :
                              (lead.sent ? 
                                <span className="text-green-600 font-bold text-xs flex items-center"><i data-lucide="check" className="w-3 h-3 mr-1"></i> ENVIADO</span> : 
                                <span className="text-gray-400 font-bold text-xs">PENDENTE</span>
                              )
                            }
                          </td>
                          <td className="p-4 font-medium text-gray-900">{lead.name}</td>
                          <td className="p-4 text-gray-600 font-mono">
                            {lead.status === 'valid' ? lead.phone : <span className="line-through opacity-50">{lead.rawPhone}</span>}
                          </td>
                          <td className="p-4 text-right">
                            {lead.status === 'valid' && (
                              <button 
                                onClick={() => handleSend(lead)}
                                className={`inline-flex items-center px-4 py-1.5 rounded-full text-xs font-bold transition-transform active:scale-95 ${lead.sent ? 'bg-white border border-green-500 text-green-600' : 'bg-[#25D366] text-white shadow-lg hover:shadow-xl'}`}
                              >
                                {lead.sent ? 'Reenviar' : 'Enviar WhatsApp'} 
                                <i data-lucide="send" className="ml-1.5 w-3 h-3"></i>
                              </button>
                            )}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          );
        };

        const RenderHome = () => (
          <div className="flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 h-full">
            <div className="max-w-md w-full text-center">
              <div className="w-20 h-20 bg-primary rounded-2xl mx-auto flex items-center justify-center mb-6 shadow-2xl">
                <i data-lucide="zap" className="text-gold w-10 h-10"></i>
              </div>
              <h1 className="text-4xl font-serif font-bold text-primary mb-2">ZapHub Pro</h1>
              <p className="text-gray-500 mb-8">Central de automação para geração de leads.</p>

              <div className="bg-white p-8 rounded-xl shadow-lg border-2 border-dashed border-gray-300 hover:border-gold transition-colors cursor-pointer relative">
                <input 
                  type="file" 
                  className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                  onChange={handleFileUpload}
                  accept=".csv, .xlsx, .xls"
                />
                <i data-lucide="file-spreadsheet" className="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                <h3 className="text-lg font-bold text-gray-700">Importar Planilha</h3>
                <p className="text-sm text-gray-400 mt-2">Arraste ou clique para selecionar (.xlsx, .csv)</p>
              </div>

              <div className="mt-8 grid grid-cols-2 gap-4">
                <div className="bg-white p-4 rounded-lg shadow-sm text-left">
                  <div className="text-gold font-bold text-xl mb-1">100%</div>
                  <div className="text-xs text-gray-500">Precisão de Leitura</div>
                </div>
                <div className="bg-white p-4 rounded-lg shadow-sm text-left">
                  <div className="text-gold font-bold text-xl mb-1">Local</div>
                  <div className="text-xs text-gray-500">Privacidade Total</div>
                </div>
              </div>
            </div>
          </div>
        );

        // --- NICHE SPECIFIC WRAPPER ---
        // If a niche is active but NO file is loaded, show the Niche "Home"
        // If file loaded, show processing table inside Niche context
        const RenderNicheView = () => {
           if (leads.length > 0) return <RenderLeadsTable />;
           if (mapStep) return <RenderMappingStep />;

           return (
             <div className="p-8 h-full flex flex-col">
               <div className="flex items-center mb-8">
                 <div className="p-3 bg-white rounded-lg shadow-sm mr-4">
                   <i data-lucide={activeNiche.icon} className="text-primary w-6 h-6"></i>
                 </div>
                 <h1 className="text-3xl font-serif font-bold text-primary">{activeNiche.label}</h1>
               </div>

               {/* Niche Specific Feature Demo */}
               <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                 <div className="lg:col-span-2 bg-gradient-to-r from-primary to-slate-900 rounded-2xl p-8 text-white relative overflow-hidden shadow-xl">
                    <div className="relative z-10">
                      <h3 className="text-xl font-bold mb-2">Ferramenta Especializada</h3>
                      <p className="text-gray-400 mb-6">Este módulo contém configurações otimizadas para {activeNiche.label}, incluindo scripts de alta conversão.</p>
                      <button onClick={() => document.getElementById('niche-upload').click()} className="bg-gold text-primary px-6 py-2 rounded-lg font-bold hover:bg-white transition-colors">
                        Começar Agora
                      </button>
                      <input id="niche-upload" type="file" className="hidden" onChange={handleFileUpload} accept=".xlsx,.csv" />
                    </div>
                    <i data-lucide={activeNiche.icon} className="absolute right-[-20px] bottom-[-20px] w-48 h-48 text-white opacity-5"></i>
                 </div>
                 
                 <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center items-center text-center">
                    <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-4">
                      <i data-lucide="message-circle" className="w-6 h-6"></i>
                    </div>
                    <h4 className="font-bold text-gray-800">Script Sugerido</h4>
                    <p className="text-xs text-gray-500 mt-2 italic">"Olá [Nome], vi que você tem interesse em {activeNiche.label.split(' ')[0]}..."</p>
                    <button className="mt-4 text-xs text-primary font-bold hover:underline" onClick={() => navigator.clipboard.writeText(`Olá [Nome], vi que você tem interesse em ${activeNiche.label}...`)}>Copiar Script</button>
                 </div>
               </div>
             </div>
           );
        };

        // --- MAIN RENDER ---
        return (
          <div className="flex h-screen overflow-hidden bg-gray-50">
            <RenderSidebar />
            <div className="flex-1 flex flex-col h-screen overflow-auto relative">
              
              {/* Mobile Header */}
              <div className="md:hidden bg-primary text-white p-4 flex justify-between items-center shadow-md z-10">
                 <span className="font-bold font-serif">ZapHub</span>
                 <button onClick={() => setActiveNiche(null)}><i data-lucide="menu"></i></button>
              </div>

              {/* View Router */}
              {viewHistory ? (
                <RenderHistory />
              ) : activeNiche ? (
                <RenderNicheView />
              ) : mapStep ? (
                <RenderMappingStep />
              ) : leads.length > 0 ? (
                <RenderLeadsTable />
              ) : (
                <RenderHome />
              )}

              {/* Floating WhatsApp Global */}
              <a 
                href="https://wa.me/?text=Suporte" 
                target="_blank" 
                className="fixed bottom-6 right-6 bg-[#25D366] hover:bg-[#20ba56] text-white p-4 rounded-full shadow-2xl transition-transform hover:scale-110 z-50 flex items-center justify-center"
              >
                <i data-lucide="message-circle" className="w-8 h-8 fill-current"></i>
              </a>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
    